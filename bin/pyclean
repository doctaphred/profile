#!/usr/bin/env bash -euo pipefail

# Remove compiled Python files from the given directory or $PWD.

# `cd` with no args defaults to $HOME, but `cd <empty string>` is a
# no-op: if no argument is given, nothing happens.
cd "${1:-}"

echo "Removing compiled Python files from $PWD ..."

if command -v fd >/dev/null 2>&1; then
    # fd args:
    #   -HI (--hidden --no-ignore): include hidden and ignored files.
    #   -t (--type): only specific file types.
    #       f (file): regular files (not directories).
    #       d (directory): directories.
    #       e (empty): empty files or directories.
    #   -e (--extension): only files matching the extension.
    #   -x: execute the following command for each result.
    #
    # rm args:
    #   -v: print paths as they are removed.
    fd -HI -tf -epyc -x rm -v
    fd -HI -tf -epyo -x rm -v
    fd -HI -td -te '^__pycache__$' -x rm -vr
else
    echo "fd not found; using find"
    find . -name '*.pyc' -exec echo {} ';' -delete
    find . -name '__pycache__' -exec echo {} ';' -delete
fi
# TODO: print number of removed files.
echo "Done"
